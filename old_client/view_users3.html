<style>
    #div_id {
        background-color: yellow
    }

    p {
        color: red;
        font-size: 16px;
    }

    button {
        font-size: 30px;
    }

    #title_text1 {
        font-size: 12px;
        font-weight: bold;
        background-color: brown;
        color: gold;
    }

    .title_text1 {
        font-size: 12px;
        font-weight: bold;
        background-color: brown;
        color: gold;
    }

    th {
        font-size: 12px;
        font-weight: bold;
        background-color: brown;
        color: gold;
    }

    #data1 {
        font-size: 12px;
        background-color: antiquewhite;
        color: green;
        font-weight: bold;
    }

    body {
        background-color: burlywood;
    }
</style>


<script>
    function getUsers() {
        console.log("Get users from mysql database via fetch !");


        //post body
        let postData = {
            method: 'POST',
            headers: {
                Accept: 'application/json',
                'Content-Type': 'application/json',
            },
            body: JSON.stringify("OK"),
        };

        //fetch
        let host = "http://127.0.0.1:5659";
        let link = "/read_from_database3";

        fetch(host + link, postData)
            .then((resp) => {
                console.log(" >>> first then happen");
                //return resp.json(); 
                return resp.text();
            })
            .then((response) => {
                console.log("Fetch response happen !");
                /*
                 console.log("Database data : " + JSON.parse(response));
                 var obj = JSON.parse(response);
                 console.log(obj.body.db);
                 var myarray = obj.body.db;
 
                 for (var element in myarray) {
                      console.log(" ++++++> " + myarray[element] );
                 }
                  */


                var view_response_content = [];
                view_response_content.splice(0, view_response_content.length);

                var p_fname = JSON.parse(response).body.r_fname;
                var p_lname = JSON.parse(response).body.r_lname;
                var p_status = JSON.parse(response).body.r_status;

                console.log("Fname >>>>> " + p_fname);
                console.log("Lname >>>>> " + p_lname);
                console.log("Status >>>>> " + p_status);


                for (var array_index in p_fname) {

                    //view_response_content.push( <td> p_fname[array_index] </td> );
                    //view_response_content.push( <td> p_lname[array_index] </td> );
                    //view_response_content.push( <td> p_status[array_index] </td> ); 

                    /*
                    console.log( "Fname : " 
                        + p_fname[array_index] 
                        + "Lname :" 
                        + p_lname[array_index]
                        + "Status :"
                        +p_status[array_index]
                    );
                    */

                    var val = 5000;
                    var vall = "abcd";

                    view_response_content.push(
                        "<tr>" +
                        "<td>" + p_fname[array_index] + " </td> " +
                        "<td>" + p_lname[array_index] + "</td>" +
                        "<td>" + p_status[array_index] + "</td>" +
                        //generate id-value for button equaled to database user id, to open current user in profile page
                        // "<td> Profile :  <a href='profile.html?id='"+array_index+"'> link"+array_index+" </a>  <form action='profile.html' method='get'><input type='submit' value='123'> <button class='title_text1' id=p'" + array_index + "' onclick='profile_button_event("+array_index+")' value='p"+array_index+"'>" + random_number() + "</button><form></td>" +
                       //onclick='profile_button_event("+array_index+")'
                            "<td><button class='title_text1' onclick='profile_button_event("+array_index+")' id='p"+array_index+"' > User profiles </button></td>" +
                        "</tr>"
                    );


                    //view_response_content.push( p_fname[array_index] );



                    /*
                    view_response_content.push(
                        <table>
                        <tr>
                            <td> 1 </td>
                            <td> 2 </td>
                            <td> 3 </td>
                        </tr>
                        </table>
                    );
                    */

                }


                var view_element_content = [];
                view_element_content.splice(0, view_element_content.length);
                view_element_content.push(
                    "<table border='3' id='data1'><th>First Name</th><th>Last Name</th><th>Status</th>"
                    + view_response_content +
                    "</table>");



                //JSON.parse(response).body.db.forEach((v) => console.log(v))



                document.getElementById("answer_field").innerHTML = view_element_content;//response;



            })
            .catch(function (error_msg) {
                // error if connection problem happens 
                console.log("Fetch error : " + error_msg);
                document.getElementById("answer_field").innerHTML = "<div align='center'><font color='red'><h1>Node Server is down ! </h1></font></div>";
            })

    }


    function profile_button_event(button_index) {

        var profile_value = document.getElementById("p" + button_index);

        // var button_index
        console.log("Button " + button_index + "clicked with value : " + profile_value);




    }


    function random_number() {

        let min_value = 1000;
        let max_value = 9999;

        return Math.floor(Math.random() * (max_value - min_value)) + min_value;
    }

</script>

<html>

<title> View all users from database </title>

<body onload="getUsers()">
    <button onclick="getUsers()" id="title_text1"> Refresh data</button>
    <br /><br />
    <p id="answer_field"></p>
</body>

</html>